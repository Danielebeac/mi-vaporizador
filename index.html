<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&B Scanner</title>
    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; padding: 20px; }
        button { font-size: 20px; padding: 15px; width: 100%; background: #222; color: #fff; border: 1px solid #555; cursor: pointer; }
        #log { margin-top: 20px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px; text-align: left; }
        .uuid { color: #ffff00; }
        .val { color: #00ffff; }
        .prop { color: #ff00ff; }
    </style>
</head>
<body>
    <h1>üîç ESC√ÅNER DE UUIDs</h1>
    <p>Este script listar√° todas las caracter√≠sticas disponibles dentro del servicio principal.</p>
    
    <button onclick="escanear()">INICIAR ESCANEO</button>
    
    <div id="log">Esperando...</div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += msg + "\n";
        }

        async function escanear() {
            document.getElementById('log').innerHTML = "Iniciando...\n";
            
            // EL SERVICIO PRINCIPAL QUE YA SABEMOS QUE FUNCIONA
            const SERVICE_UUID = '00000001-4c45-4b43-4942-265a524f5453';

            try {
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'STORZ' }],
                    optionalServices: [SERVICE_UUID]
                });

                log(`‚úÖ Conectado a: ${device.name}`);
                
                const server = await device.gatt.connect();
                log("‚úÖ Servidor GATT conectado");

                const service = await server.getPrimaryService(SERVICE_UUID);
                log("‚úÖ Servicio Principal obtenido");
                log("------------------------------------------------");

                // OBTENER TODAS LAS CARACTER√çSTICAS
                const characteristics = await service.getCharacteristics();

                for (const c of characteristics) {
                    // Limpiamos el UUID para que sea f√°cil de leer (solo los primeros 8 d√≠gitos)
                    const shortUUID = c.uuid.substring(0, 8);
                    
                    let properties = [];
                    if (c.properties.read) properties.push("READ");
                    if (c.properties.write) properties.push("WRITE");
                    if (c.properties.notify) properties.push("NOTIFY");
                    
                    let valueStr = "N/A";

                    // Intentamos leer el valor si es posible
                    if (c.properties.read) {
                        try {
                            const val = await c.readValue();
                            // Intentamos interpretar el valor de varias formas
                            const int8 = val.getUint8(0);
                            const int16 = val.byteLength >= 2 ? val.getUint16(0, true) : "N/A";
                            valueStr = `(Int8: ${int8}) | (Int16: ${int16})`;
                        } catch (err) {
                            valueStr = "Error lectura";
                        }
                    }

                    log(`<span class="uuid">UUID: ...${shortUUID}</span>`);
                    log(`   Props: <span class="prop">[${properties.join(', ')}]</span>`);
                    log(`   Valor: <span class="val">${valueStr}</span>`);
                    log("------------------------------------------------");
                }
                
                log("üèÅ ESCANEO FINALIZADO");

            } catch (error) {
                log("‚ùå ERROR: " + error);
            }
        }
    </script>
</body>
</html>
